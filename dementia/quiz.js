const quizData = {
  symptoms: [
    {
      question: "What is dementia?",
      options: [
        "A group of neurological disorders",
        "An infectious disease",
        "A type of mental illness",
        "A form of physical disability",
      ],
      correct: "A group of neurological disorders",
    },
    {
      question: "Which of the following is a common early symptom of dementia?",
      options: [
        "Sudden weight loss",
        "Impaired vision",
        "Memory loss",
        "Frequent headaches",
      ],
      correct: "Memory loss",
    },
    {
      question: "Dementia primarily affects which organ of the body?",
      options: ["Heart", "Liver", "Lungs", "Brain"],
      correct: "Brain",
    },
    {
      question: "What cognitive functions are primarily affected by dementia?",
      options: [
        "Motor skills",
        "Language abilities",
        "Hearing capacity",
        "Taste and smell senses",
      ],
      correct: "Language abilities",
    },
    {
      question:
        "What is the most significant risk factor for developing dementia?",
      options: ["Smoking", "Obesity", "Age", "Lack of exercise"],
      correct: "Age",
    },
    {
      question: "What is the main goal of dementia care?",
      options: [
        "Curing dementia",
        "Slowing disease progression",
        "Improving quality of life",
        "Preventing dementia",
      ],
      correct: "Improving quality of life",
    },
    {
      question:
        "Which stage of dementia is characterized by severe memory loss, disorientation, and difficulty with communication?",
      options: [
        "Early stage",
        "Middle stage",
        "Late stage",
        "Preclinical stage",
      ],
      correct: "Late stage",
    },
    {
      question:
        "In addition to memory loss, individuals with dementia may experience difficulty with:",
      options: [
        "Balance and coordination",
        "Hearing and vision",
        "Taste and smell",
        "Decision-making and problem-solving",
      ],
      correct: "Decision-making and problem-solving",
    },
  ],
  behaviors: [
    {
      question:
        "What are some common behavioral changes associated with dementia?",
      options: [
        "Increased memory retention",
        "Improved attention span",
        "Agitation and restlessness",
        "Enhanced communication skills",
      ],
      correct: "Agitation and restlessness",
    },
    {
      question:
        "How can caregivers respond to agitation in individuals with dementia?",
      options: [
        "Raise their voice to get their attention",
        "Offer reassurance and a calm presence",
        "Use complex language to stimulate their memory",
        "Ignore the behavior until it stops",
      ],
      correct: "Offer reassurance and a calm presence",
    },
    {
      question: "What does redirection mean in managing dementia behaviors?",
      options: [
        "Ignoring problematic behaviors",
        "Escalating the situation",
        "Diverting their attention to a different activity",
        "Restraining the individual",
      ],
      correct: "Diverting their attention to a different activity",
    },
    {
      question:
        "Why is maintaining a structured routine important for individuals with dementia?",
      options: [
        "It limits their options and freedom",
        "It helps reduce confusion and anxiety",
        "It encourages aggressive behavior",
        "It increases memory retention",
      ],
      correct: "It helps reduce confusion and anxiety",
    },
    {
      question:
        "What should caregivers do when dealing with repetitive questions from someone with dementia?",
      options: [
        "Provide different answers each time to keep them engaged",
        "Avoid answering and change the subject",
        "Respond patiently and calmly with the same correct",
        "Raise their voice to discourage further questioning",
      ],
      correct: "Respond patiently and calmly with the same correct",
    },
    {
      question:
        "Which of the following strategies can help prevent wandering in individuals with dementia?",
      options: [
        "Encourage them to explore outdoors alone",
        "Keep the living environment unfamiliar and constantly changing",
        "Install locks and alarms on doors and windows",
        "Disregard their desire to wander",
      ],
      correct: "Install locks and alarms on doors and windows",
    },
    {
      question:
        "What is the role of empathy in dealing with dementia behaviors?",
      options: [
        "Disregard the emotions and focus on managing behaviors",
        "Acknowledge and understand their feelings and experiences",
        "Encourage them to suppress their emotions",
        "Avoid emotional involvement to maintain professionalism",
      ],
      correct: "Acknowledge and understand their feelings and experiences",
    },
    {
      question:
        "What is the primary purpose of using visual aids and gestures in communication with dementia patients?",
      options: [
        "To entertain the patient",
        "To make communication more complicated",
        "To support verbal communication and enhance understanding",
        "To replace verbal communication entirely",
      ],
      correct: "To support verbal communication and enhance understanding",
    },
  ],
  communication: [
    {
      question:
        "When communicating with dementia patients, it is essential to:",
      options: [
        "Speak loudly to get their attention.",
        "Use complex sentences to stimulate their memory.",
        "Maintain a calm and positive demeanor.",
        "Interrupt them to correct their mistakes.",
      ],
      correct: "Maintain a calm and positive demeanor.",
    },
    {
      question:
        "What is the purpose of using visual aids and gestures during communication?",
      options: [
        "To entertain the patient",
        "To make communication more complicated",
        "To support verbal communication and enhance understanding",
        "To replace verbal communication entirely",
      ],
      correct: "To support verbal communication and enhance understanding",
    },
    {
      question:
        "How should you handle a situation when a dementia patient becomes agitated during a conversation?",
      options: [
        "Raise your voice to match their level of agitation.",
        "Walk away and come back later.",
        "Validate their feelings and offer reassurance.",
        "Argue with them to correct their misconceptions.",
      ],
      correct: "Validate their feelings and offer reassurance.",
    },
    {
      question:
        "What can you do to help redirect the attention of a dementia patient who is fixated on a specific behavior or idea?",
      options: [
        "Ignore them until they stop the behavior.",
        "Join in with the behavior to make them feel understood.",
        "Gently redirect their attention to a different activity or topic.",
        "Speak louder to get their focus.",
      ],
      correct:
        "Gently redirect their attention to a different activity or topic.",
    },
    {
      question:
        "Why is maintaining eye contact important during communication with dementia patients?",
      options: [
        "It helps control their behavior.",
        "It makes them feel intimidated.",
        "It helps them focus on the conversation and feel connected.",
        "It increases the risk of agitation.",
      ],
      correct: "It helps them focus on the conversation and feel connected.",
    },
    {
      question:
        "How can you adapt your communication style when interacting with dementia patients with varying abilities?",
      options: [
        "Avoid communication altogether to prevent confusion.",
        "Use the same approach for all patients, regardless of their abilities.",
        "Be flexible and adjust your style based on their preferences and communication patterns.",
        "Speak louder and slower to ensure they understand.",
      ],
      correct:
        "Be flexible and adjust your style based on their preferences and communication patterns.",
    },
    {
      question:
        "What does empathy mean in the context of communication with dementia patients?",
      options: [
        "Disregarding their emotions",
        "Acknowledging their feelings and experiences",
        "Forcing them to comply with your requests",
        "Telling them to stop being emotional",
      ],
      correct: "Acknowledging their feelings and experiences",
    },
    {
      question:
        "Which type of communication is more effective for individuals with dementia?",
      options: [
        "Fast-paced conversations",
        "Conversations with multiple topics at once",
        "Conversations focusing on feelings and memories",
        "Lectures and long explanations",
      ],
      correct: "Conversations focusing on feelings and memories",
    },
  ],
};

let chosenTopic = "";
let currentQuestion = 0;
let score = 0;
let chosenAnswers = [];

function startQuiz(topic) {
  fetch("check_access.php") // Use the PHP file to check access
    .then((response) => response.text())
    .then((accessStatus) => {
      if (accessStatus === "grant_access") {
        chosenTopic = topic;
        currentQuestion = 0;
        score = 0;
        chosenAnswers = [];
        showQuestion();
      } else if (accessStatus === "incomplete") {
        alert(
          "You need to complete all the reading before attempting these quiz."
        );
      } else if (accessStatus === "not_logged_in") {
        alert("You need to log in to access the quiz.");
      } else {
        alert("An error occurred while checking access.");
      }
    })
    .catch((error) => {
      console.error("Error checking access:", error);
    });
}

function showQuestion() {
  const quizContainer = document.createElement("div");
  quizContainer.classList.add("container");
  quizContainer.innerHTML = `
    <h1>Question ${currentQuestion + 1}:</h1>
    <p>${quizData[chosenTopic][currentQuestion].question}</p>
    <ul class="options">
      <li><input type="radio" name="correct" value="${
        quizData[chosenTopic][currentQuestion].options[0]
      }">${quizData[chosenTopic][currentQuestion].options[0]}</li>
      <li><input type="radio" name="correct" value="${
        quizData[chosenTopic][currentQuestion].options[1]
      }">${quizData[chosenTopic][currentQuestion].options[1]}</li>
      <li><input type="radio" name="correct" value="${
        quizData[chosenTopic][currentQuestion].options[2]
      }">${quizData[chosenTopic][currentQuestion].options[2]}</li>
      <li><input type="radio" name="correct" value="${
        quizData[chosenTopic][currentQuestion].options[3]
      }">${quizData[chosenTopic][currentQuestion].options[3]}</li>
    </ul>
    <button onclick="checkAnswer()">Submit Answer</button>
    <p>Score: ${score}</p>
  `;
  document.body.innerHTML = "";
  document.body.appendChild(quizContainer);
}

function checkAnswer() {
  const selectedOption = document.querySelector(
    'input[name="correct"]:checked'
  );
  if (!selectedOption) {
    alert("Please select an answer.");
    return;
  }

  const chosenAnswer = selectedOption.value;
  const correctAnswer = quizData[chosenTopic][currentQuestion].correct;

  chosenAnswers.push({
    question: quizData[chosenTopic][currentQuestion].question,
    chosen: chosenAnswer,
    correct: correctAnswer,
  });

  if (chosenAnswer === correctAnswer) {
    score++;
  }

  currentQuestion++;

  if (currentQuestion < quizData[chosenTopic].length) {
    showQuestion();
  } else {
    showResults();
  }
}

function showResults() {
  const resultsContainer = document.createElement("div");
  resultsContainer.classList.add("container");
  let resultsHtml = "<h1>Quiz Results</h1>";
  resultsHtml += `<p>Score: ${score} / ${quizData[chosenTopic].length}</p>`;
  resultsHtml += "<h2>Questions and Answers:</h2>";
  resultsHtml += "<ul>";
  for (let i = 0; i < chosenAnswers.length; i++) {
    resultsHtml += "<li>";
    resultsHtml += `<p>Question: ${chosenAnswers[i].question}</p>`;
    resultsHtml += `<p>Chosen Answer: ${chosenAnswers[i].chosen}</p>`;
    resultsHtml += `<p>Correct Answer: ${chosenAnswers[i].correct}</p>`;
    resultsHtml += "</li>";
  }
  resultsHtml += "</ul>";
  resultsHtml += '<button onclick="retryQuiz()">Retry Quiz</button>';
  resultsHtml += '<button onclick="saveResults()">Save Results</button>';
  resultsContainer.innerHTML = resultsHtml;
  document.body.innerHTML = "";
  document.body.appendChild(resultsContainer);
}

function retryQuiz() {
  const topicContainer = document.createElement("div");
  topicContainer.classList.add("container");
  topicContainer.innerHTML = `
    <h2 class="choose">Choose a Topic</h2>
    <ul class="topic-list">
      <li onclick="startQuiz('symptoms')">Dementia Symptoms</li>
      <li onclick="startQuiz('behaviors')">Dealing with Dementia Behaviors</li>
      <li onclick="startQuiz('communication')">Communication Tips</li>
    </ul>
  `;
  document.body.innerHTML = "";
  document.body.appendChild(topicContainer);
}

function saveResults() {
  const totalQuestions = quizData[chosenTopic].length;
  const percentageScore = (score / totalQuestions) * 100;

  console.log("Chosen Topic:", chosenTopic);
  console.log("Percentage Score:", percentageScore);

  // Create a FormData object to send the data as key-value pairs
  const formData = new FormData();
  formData.append("topic", chosenTopic);
  formData.append("score", percentageScore);

  // Send the fetch request
  fetch("save_score.php", {
    method: "POST",
    body: formData, // Use the FormData object here
  })
    .then((response) => response.json())
    .then((data) => {
      console.log("Response from server:", data);
      if (data.success) {
        console.log("Score saved successfully");
      } else {
        console.error("Error saving score:", data.error);
      }
      retryQuiz();
    })
    .catch((error) => {
      console.error("Error saving score:", error);
    });
}
